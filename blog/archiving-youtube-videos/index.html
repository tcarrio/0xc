<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
      
    

      <title></title>

      
        

        
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.carrio.dev/rss.xml">
        
      

      
          <link rel="stylesheet" href="https://blog.carrio.dev/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        
    
        
                
                    <header>
                        <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
                        
                            <a itemprop="url"
                               class=""
                               href="https://blog.carrio.dev">
                                <span itemprop="name">Home</span></a>
                        
                            <a itemprop="url"
                               class=""
                               href="https://blog.carrio.dev/blog">
                                <span itemprop="name">Blog</span></a>
                        
                            <a itemprop="url"
                               class=""
                               href="https://blog.carrio.dev/tags">
                                <span itemprop="name">Tags</span></a>
                        
                        </nav>
                    </header>
                
            
    

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">Archiving YouTube Videos</h1>
        <span class="muted">
    <svg class="icon i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>4 minute read</span>
    <svg class="icon i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2025-01-23
</span>
    </header>
    <div itemprop="articleBody">
        <hr/>
        

<div class="toc">
Table of Contents:
    <ul>
    
        <li>
            <a href="https://blog.carrio.dev/blog/archiving-youtube-videos/#downloading-content-from-youtube">Downloading content from YouTube</a>
            
        </li>
    
        <li>
            <a href="https://blog.carrio.dev/blog/archiving-youtube-videos/#splicing-our-audio-and-video-together">Splicing our audio and video together</a>
            
        </li>
    
        <li>
            <a href="https://blog.carrio.dev/blog/archiving-youtube-videos/#verifying-your-content">Verifying your content</a>
            
        </li>
    
    </ul>
</div>


        <hr />
        <p>It all started with a wedding. You hire a videographer, you wait patiently for several weeks, and finally your video is available. It's hosted on YouTube, quick and easy to start watching right away! However I can never know if this precious video may disappear, if their account may get deleted, or some other event may occur that causes such an important moment in our lives to disappear. This post provides a straightforward solution to archiving YouTube videos, in my case with a focus on retaining as high of quality as possible.</p>
<h2 id="downloading-content-from-youtube">Downloading content from YouTube</h2>
<p>We are not pirating content, and have permission from our videographer to store this video. I may even have an external hard drive sitting around with it. But who wants to risk that breaking or disappearing? There is an existing open source project for downloading videos from YouTube and other sites called <a href="https://github.com/yt-dlp/yt-dlp"><strong>yt-dlp</strong></a>. This works perfectly for our scenario.</p>
<p>Without diving too deep into the specifics, there are many formats of content available from YouTube even for a single "video". Each video on YouTube can be accessed at various resolutions and audio qualities. We start off by listing what is available with the following command:</p>
<p><code>yt-dlp --list-formats 'https://www.youtube.com/watch?v=deadbeef'</code></p>
<p>This will output a table with the available audio and video formats for the YouTube video. It is not uncommon for the formats to be completely separate, as in you have audio-only and video-only formats. We will cover the steps necessary for this scenario.</p>
<p>Let's suppose the output from the command looked something like this:</p>
<pre style="background-color:#171c19;color:#87928a;"><code><span>ID  EXT   RESOLUTION FPS CH │   FILESIZE    TBR PROTO │ VCODEC           VBR ACODEC      ABR ASR MORE INFO
</span><span>───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span><span>sb2 mhtml 48x27        0    │                   mhtml │ images                                   storyboard
</span><span>sb1 mhtml 80x45        0    │                   mhtml │ images                                   storyboard
</span><span>sb0 mhtml 160x90       0    │                   mhtml │ images                                   storyboard
</span><span>233 mp4   audio only        │                   m3u8  │ audio only           unknown             [en] Default
</span><span>234 mp4   audio only        │                   m3u8  │ audio only           unknown             [en] Default
</span><span>139 m4a   audio only      2 │    2.12MiB    49k https │ audio only           mp4a.40.5   49k 22k [en] low, m4a_dash
</span><span>249 webm  audio only      2 │    2.16MiB    50k https │ audio only           opus        50k 48k [en] low, webm_dash
</span><span>250 webm  audio only      2 │    2.87MiB    66k https │ audio only           opus        66k 48k [en] low, webm_dash
</span><span>140 m4a   audio only      2 │    5.63MiB   129k https │ audio only           mp4a.40.2  129k 44k [en] medium, m4a_dash
</span><span>251 webm  audio only      2 │    5.64MiB   130k https │ audio only           opus       130k 48k [en] medium, webm_dash
</span><span>602 mp4   256x144     12    │ ~  4.00MiB    92k m3u8  │ vp09.00.10.08    92k video only
</span><span>269 mp4   256x144     24    │ ~  7.76MiB   179k m3u8  │ avc1.4D400C     179k video only
</span><span>160 mp4   256x144     24    │    3.53MiB    81k https │ avc1.4D400C      81k video only          144p, mp4_dash
</span><span>603 mp4   256x144     24    │ ~  7.32MiB   169k m3u8  │ vp09.00.11.08   169k video only
</span><span>278 webm  256x144     24    │    3.71MiB    85k https │ vp09.00.11.08    85k video only          144p, webm_dash
</span><span>229 mp4   426x240     24    │ ~ 13.83MiB   319k m3u8  │ avc1.4D4015     319k video only
</span><span>133 mp4   426x240     24    │    7.99MiB   184k https │ avc1.4D4015     184k video only          240p, mp4_dash
</span><span>604 mp4   426x240     24    │ ~ 13.51MiB   311k m3u8  │ vp09.00.20.08   311k video only
</span><span>242 webm  426x240     24    │    6.30MiB   145k https │ vp09.00.20.08   145k video only          240p, webm_dash
</span><span>230 mp4   640x360     24    │ ~ 31.52MiB   726k m3u8  │ avc1.4D401E     726k video only
</span><span>134 mp4   640x360     24    │   15.18MiB   349k https │ avc1.4D401E     349k video only          360p, mp4_dash
</span><span>605 mp4   640x360     24    │ ~ 26.07MiB   601k m3u8  │ vp09.00.21.08   601k video only
</span><span>243 webm  640x360     24    │   10.97MiB   253k https │ vp09.00.21.08   253k video only          360p, webm_dash
</span><span>231 mp4   854x480     24    │ ~ 58.71MiB  1353k m3u8  │ avc1.4D401E    1353k video only
</span><span>135 mp4   854x480     24    │   31.68MiB   729k https │ avc1.4D401E     729k video only          480p, mp4_dash
</span><span>606 mp4   854x480     24    │ ~ 41.26MiB   951k m3u8  │ vp09.00.30.08   951k video only
</span><span>244 webm  854x480     24    │   18.21MiB   419k https │ vp09.00.30.08   419k video only          480p, webm_dash
</span><span>232 mp4   1280x720    24    │ ~106.77MiB  2460k m3u8  │ avc1.64001F    2460k video only
</span><span>136 mp4   1280x720    24    │   61.14MiB  1408k https │ avc1.64001F    1408k video only          720p, mp4_dash
</span><span>609 mp4   1280x720    24    │ ~ 76.00MiB  1752k m3u8  │ vp09.00.31.08  1752k video only
</span><span>247 webm  1280x720    24    │   32.92MiB   758k https │ vp09.00.31.08   758k video only          720p, webm_dash
</span><span>270 mp4   1920x1080   24    │ ~215.93MiB  4976k m3u8  │ avc1.640028    4976k video only
</span><span>137 mp4   1920x1080   24    │  115.89MiB  2668k https │ avc1.640028    2668k video only          1080p, mp4_dash
</span><span>614 mp4   1920x1080   24    │ ~124.34MiB  2865k m3u8  │ vp09.00.40.08  2865k video only
</span><span>248 webm  1920x1080   24    │   56.64MiB  1304k https │ vp09.00.40.08  1304k video only          1080p, webm_dash
</span><span>620 mp4   2560x1440   24    │ ~352.28MiB  8118k m3u8  │ vp09.00.50.08  8118k video only
</span><span>271 webm  2560x1440   24    │  172.62MiB  3974k https │ vp09.00.50.08  3974k video only          1440p, webm_dash
</span><span>625 mp4   3840x2160   24    │ ~634.40MiB 14620k m3u8  │ vp09.00.50.08 14620k video only
</span><span>313 webm  3840x2160   24    │  332.22MiB  7649k https │ vp09.00.50.08  7649k video only          2160p, webm_dash
</span></code></pre>
<p>There are video resolutions of 320p, 480p, 720p, etc. all the way to 2160p (4K). Additionally, there are multiple audio options available, with some useful information providing a high-level quality such as "low" and "medium". In my case, I will prefer the highest quality available for both audio and video, and make some preferential decisions on the formats. Let's go with the Opus audio codec in medium-quality and WebM video format in 2160p, or format IDs <strong>251</strong> and <strong>313</strong> respectively.</p>
<p>I will use <strong>yt-dlp</strong> to download each of these formats to separate files before joining them together.</p>
<pre style="background-color:#171c19;color:#87928a;"><code><span># download the audio file
</span><span>yt-dlp -f 251 -o wedding.audio.webm &#39;https://www.youtube.com/watch?v=deadbeef&#39;
</span><span>
</span><span># download the video file
</span><span>yt-dlp -f 313 -o cwedding.video.webm &#39;https://www.youtube.com/watch?v=deadbeef&#39;
</span></code></pre>
<p>These are both saved to WebM files, as it is only a container format that supports various video and audio formats within itself. With both files downloaded, our next task will be to join the two files together into a single, 4K AV file.</p>
<h2 id="splicing-our-audio-and-video-together">Splicing our audio and video together</h2>
<p>A renowned tool for working with audio and video files is <a href="https://ffmpeg.org/"><strong>ffmpeg</strong></a>. We will use this to pull the audio from the audio-only WebM file and the video from the video-only WebM file. The command we will run for this is:</p>
<pre style="background-color:#171c19;color:#87928a;"><code><span>ffmpeg \
</span><span>  -i wedding.video.webm \
</span><span>  -i wedding.audio.webm \
</span><span>  -c:v copy \
</span><span>  -c:a copy \
</span><span>  -map 0:v:0 \
</span><span>  -map 1:a:0 \
</span><span>  carrio-wedding.webm
</span></code></pre>
<p>I split out the lines mostly for readability, as the command becomes more self-describing to me with this logical grouping.</p>
<p>We take two input files, first the video and then the audio file.</p>
<p>We copy over any video and audio codecs as in- no transcoding will be performed. This retains the Opus audio codec and the VP9 video codec used in these files.</p>
<p>We provide two mappings which dictate explicitly video and audio. For the first video (0, in a zero-index tool like ffmpeg), which had the video, we will pull the video. For the second video (1), which had the audio, we will pull the audio. The target for both is 0, the output file.</p>
<p>Lastly, we tell <strong>ffmpeg</strong> where to save the video: at <code>wedding.webm</code>.</p>
<p>Since there was no transcoding necessary for this, the operation should complete <em>very</em> quickly. In my case: 468ms.</p>
<h2 id="verifying-your-content">Verifying your content</h2>
<p>Load your content in a compatible video player for your content! If you decided to go with WebM &amp; Opus and targeted a high resolution like 4K, make sure you use a hardware-accelerated tool. You can also upload your content to something like Google Drive and the web player in the preview tool should automatically work for playback as well. In my case, I loaded up <a href="https://mpv.io/"><strong>mpv</strong></a> to watch this beautiful moment as it included the necessary hardware acceleration libraries for my system to playback 4K content.</p>
<pre style="background-color:#171c19;color:#87928a;"><code><span>nix-shell -p mpv --run &#39;mpv ./wedding.webm&#39;
</span></code></pre>
<p><img src="https://0xc.carrio.dev/media/posts/21/wedding-screenshot-0.png" alt="mpv playback of retrieving Anduril during wedding ceremony " /></p>

    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Tom Carrio
                
                
                
                    
                    tagged
                    
                        <a href="https://blog.carrio.dev/tags/backup/">backup</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://blog.carrio.dev/tags/nix/">nix</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://blog.carrio.dev/tags/youtube/">youtube</a>
                        
                            
                        
                    
                
            </p>
            
            
        </footer>
    
</article>


    </body>

</html>
